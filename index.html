<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virality</title>

  <link rel="stylesheet" href="./style.css" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>

<body>
    <!-- background effects -->
    <canvas id="bg-waves"></canvas>
    <div class="background-scanlines"></div>

    <div class="psp-container">
        <div class="waveform-area">
            <canvas id="visualizer"></canvas>
        </div>

        <div class="top-controls">
        <div class="controls-left">
            <button class="media-btn" title="Previous / Restart" onclick="mediaPrev()" aria-label="Previous">
                <svg class="icon" viewBox="0 0 64 32" aria-hidden="true">
                    <rect x="6" y="6" width="4" height="20" rx="1"></rect>
                    <polygon points="28,6 12,16 28,26"></polygon>
                    <polygon points="46,6 30,16 46,26"></polygon>
                </svg>
            </button>

            <button class="media-btn" id="master-play" title="Play/Pause" onclick="mediaToggle()" aria-label="Play/Pause">
                <svg class="icon icon-play" viewBox="0 0 64 32" aria-hidden="true">
                    <polygon points="22,6 22,26 46,16"></polygon>
                </svg>
                <svg class="icon icon-pause" viewBox="0 0 64 32" aria-hidden="true">
                    <rect x="22" y="6" width="6" height="20" rx="1"></rect>
                    <rect x="36" y="6" width="6" height="20" rx="1"></rect>
                </svg>
            </button>

            <button class="media-btn" title="Next" onclick="mediaNext()" aria-label="Next">
                <svg class="icon" viewBox="0 0 64 32" aria-hidden="true">
                    <polygon points="18,6 34,16 18,26"></polygon>
                    <polygon points="36,6 52,16 36,26"></polygon>
                    <rect x="54" y="6" width="4" height="20" rx="1"></rect>
                </svg>
            </button>
        </div>

        <div class="time-display" id="time-display">0:00 / 0:00</div>
        </div>

        <div class="seek-wrap" id="seek-wrap" title="Seek">
        <div class="seek-track"></div>
        <div class="seek-fill" id="seek-fill"></div>
        <div class="seek-notch" id="seek-notch" style="left:0%"></div>
        </div>

        <div class="now-playing-row">
        <div class="now-prefix">Now Playing:</div>
        <div class="title-clip" id="title-clip" aria-label="Track title">
            <div class="title-track" id="title-track">
            <div class="title-text" id="title-text">Drop audio to start</div>
            </div>
        </div>
        </div>

        <div class="glass-panel">
        <div class="sliders-group">
            <div class="control-row">
            <div class="label-row"><span>Speed</span><span id="speed-val">1.0x</span></div>
            <input type="range" min="0.5" max="1.5" step="0.05" value="1" id="speed-slider">
            </div>

            <div class="control-row">
            <div class="label-row"><span>Reverb Mix</span><span id="mix-val">0%</span></div>
            <input type="range" min="0" max="1" step="0.05" value="0" id="mix-slider">
            </div>

            <div class="control-row">
            <div class="label-row"><span>Reverb Decay</span><span id="decay-val">1.5s</span></div>
            <input type="range" min="0.5" max="10" step="0.5" value="1.5" id="decay-slider">
            </div>
        </div>

        <div class="presets-group" id="presets-group"></div>
        </div>

        <div class="file-list-panel">
        <div class="export-controls">
            <div class="upload-trigger" onclick="document.getElementById('audio-upload').click()">
            + UPLOAD FILES
            </div>

            <div class="spacer"></div>

            <select id="export-format" title="Export format">
            <option value="wav">WAV</option>
            <option value="mp3">MP3</option>
            </select>

            <select id="export-bitrate" title="MP3 bitrate">
            <option value="128">128 kbps</option>
            <option value="160">160 kbps</option>
            <option value="192" selected>192 kbps</option>
            <option value="256">256 kbps</option>
            <option value="320">320 kbps</option>
            </select>

            <button class="btn" id="batch-btn" style="padding:10px 12px; font-size:16px;" onclick="batchDownload()">Batch Download</button>
        </div>

        <div id="file-rows"></div>
        </div>

        <input type="file" id="audio-upload" accept="audio/*" multiple>
    </div>

    <div class="export-bar" id="export-bar" aria-live="polite">
        <div class="export-top">
        <div class="export-title" id="export-title">Exportingâ€¦</div>

        <div style="display:flex; align-items:center; gap:10px;">
            <button id="export-cancel" class="export-cancel-btn" type="button" disabled>Cancel</button>
            <div class="export-pct" id="export-pct">0%</div>
        </div>
        </div>

        <div class="export-track">
        <div class="export-fill" id="export-fill"></div>
        </div>
    </div>

    <script src="./js/bg-waves.js"></script>
    <script src="./js/app.js"></script>
    <script src="./js/export.js"></script>
</body>
</html>